{"ast":null,"code":"// src/controllers/DietasController.js\n// Controlador central del flujo de dieta (singleton)\n\nconst state = {\n  materiasSeleccionadas: [],\n  // [{ id, nombre, clasificacion?, temporal? }, ...]\n  detallesPorMateria: {},\n  // { [id]: { MS, EM, NDT, PB, ... } }\n  restriccionesPorMateria: {} // { [id]: { costo: number, min: number, max: number } }\n};\nexport const DietasController = {\n  // --- Lecturas / snapshot ---\n  snapshot() {\n    return JSON.parse(JSON.stringify(state));\n  },\n  getSeleccionadas() {\n    return [...state.materiasSeleccionadas];\n  },\n  getDetalleMateria(id) {\n    return state.detallesPorMateria[id] || null;\n  },\n  getRestriccionMateria(id) {\n    return state.restriccionesPorMateria[id] || null;\n  },\n  getRestricciones() {\n    return {\n      ...state.restriccionesPorMateria\n    };\n  },\n  // --- Escrituras ---\n  setSeleccionadas(arr) {\n    // arr: [{id, nombre, ...}]\n    state.materiasSeleccionadas = Array.isArray(arr) ? [...arr] : [];\n    // (opcional) limpiar restricciones huérfanas\n    const validIds = new Set(state.materiasSeleccionadas.map(m => String(m.id)));\n    Object.keys(state.restriccionesPorMateria).forEach(id => {\n      if (!validIds.has(String(id))) delete state.restriccionesPorMateria[id];\n    });\n  },\n  setDetalleMateria(id, detalle) {\n    state.detallesPorMateria[id] = {\n      ...(detalle || {})\n    };\n  },\n  setRestriccionMateria(id, data) {\n    var _data$costo, _data$min, _data$max;\n    const parsed = {\n      costo: Number((_data$costo = data === null || data === void 0 ? void 0 : data.costo) !== null && _data$costo !== void 0 ? _data$costo : 0),\n      min: Number((_data$min = data === null || data === void 0 ? void 0 : data.min) !== null && _data$min !== void 0 ? _data$min : 0),\n      max: Number((_data$max = data === null || data === void 0 ? void 0 : data.max) !== null && _data$max !== void 0 ? _data$max : 0)\n    };\n    state.restriccionesPorMateria[id] = parsed;\n  },\n  // --- Utilidades ---\n  clear() {\n    state.materiasSeleccionadas = [];\n    state.detallesPorMateria = {};\n    state.restriccionesPorMateria = {};\n  }\n};\nexport default DietasController;","map":{"version":3,"names":["state","materiasSeleccionadas","detallesPorMateria","restriccionesPorMateria","DietasController","snapshot","JSON","parse","stringify","getSeleccionadas","getDetalleMateria","id","getRestriccionMateria","getRestricciones","setSeleccionadas","arr","Array","isArray","validIds","Set","map","m","String","Object","keys","forEach","has","setDetalleMateria","detalle","setRestriccionMateria","data","_data$costo","_data$min","_data$max","parsed","costo","Number","min","max","clear"],"sources":["C:/Users/maico/OneDrive/Documentos/a/backend/src/controllers/DietasController.js"],"sourcesContent":["// src/controllers/DietasController.js\r\n// Controlador central del flujo de dieta (singleton)\r\n\r\nconst state = {\r\n    materiasSeleccionadas: [],       // [{ id, nombre, clasificacion?, temporal? }, ...]\r\n    detallesPorMateria: {},          // { [id]: { MS, EM, NDT, PB, ... } }\r\n    restriccionesPorMateria: {},     // { [id]: { costo: number, min: number, max: number } }\r\n};\r\n\r\nexport const DietasController = {\r\n    // --- Lecturas / snapshot ---\r\n    snapshot() {\r\n        return JSON.parse(JSON.stringify(state));\r\n    },\r\n\r\n    getSeleccionadas() {\r\n        return [...state.materiasSeleccionadas];\r\n    },\r\n\r\n    getDetalleMateria(id) {\r\n        return state.detallesPorMateria[id] || null;\r\n    },\r\n\r\n    getRestriccionMateria(id) {\r\n        return state.restriccionesPorMateria[id] || null;\r\n    },\r\n\r\n    getRestricciones() {\r\n        return { ...state.restriccionesPorMateria };\r\n    },\r\n\r\n    // --- Escrituras ---\r\n    setSeleccionadas(arr) {\r\n        // arr: [{id, nombre, ...}]\r\n        state.materiasSeleccionadas = Array.isArray(arr) ? [...arr] : [];\r\n        // (opcional) limpiar restricciones huérfanas\r\n        const validIds = new Set(state.materiasSeleccionadas.map(m => String(m.id)));\r\n        Object.keys(state.restriccionesPorMateria).forEach(id => {\r\n            if (!validIds.has(String(id))) delete state.restriccionesPorMateria[id];\r\n        });\r\n    },\r\n\r\n    setDetalleMateria(id, detalle) {\r\n        state.detallesPorMateria[id] = { ...(detalle || {}) };\r\n    },\r\n\r\n    setRestriccionMateria(id, data) {\r\n        const parsed = {\r\n            costo: Number(data?.costo ?? 0),\r\n            min: Number(data?.min ?? 0),\r\n            max: Number(data?.max ?? 0),\r\n        };\r\n        state.restriccionesPorMateria[id] = parsed;\r\n    },\r\n\r\n    // --- Utilidades ---\r\n    clear() {\r\n        state.materiasSeleccionadas = [];\r\n        state.detallesPorMateria = {};\r\n        state.restriccionesPorMateria = {};\r\n    },\r\n};\r\n\r\nexport default DietasController;\r\n"],"mappings":"AAAA;AACA;;AAEA,MAAMA,KAAK,GAAG;EACVC,qBAAqB,EAAE,EAAE;EAAQ;EACjCC,kBAAkB,EAAE,CAAC,CAAC;EAAW;EACjCC,uBAAuB,EAAE,CAAC,CAAC,CAAM;AACrC,CAAC;AAED,OAAO,MAAMC,gBAAgB,GAAG;EAC5B;EACAC,QAAQA,CAAA,EAAG;IACP,OAAOC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,SAAS,CAACR,KAAK,CAAC,CAAC;EAC5C,CAAC;EAEDS,gBAAgBA,CAAA,EAAG;IACf,OAAO,CAAC,GAAGT,KAAK,CAACC,qBAAqB,CAAC;EAC3C,CAAC;EAEDS,iBAAiBA,CAACC,EAAE,EAAE;IAClB,OAAOX,KAAK,CAACE,kBAAkB,CAACS,EAAE,CAAC,IAAI,IAAI;EAC/C,CAAC;EAEDC,qBAAqBA,CAACD,EAAE,EAAE;IACtB,OAAOX,KAAK,CAACG,uBAAuB,CAACQ,EAAE,CAAC,IAAI,IAAI;EACpD,CAAC;EAEDE,gBAAgBA,CAAA,EAAG;IACf,OAAO;MAAE,GAAGb,KAAK,CAACG;IAAwB,CAAC;EAC/C,CAAC;EAED;EACAW,gBAAgBA,CAACC,GAAG,EAAE;IAClB;IACAf,KAAK,CAACC,qBAAqB,GAAGe,KAAK,CAACC,OAAO,CAACF,GAAG,CAAC,GAAG,CAAC,GAAGA,GAAG,CAAC,GAAG,EAAE;IAChE;IACA,MAAMG,QAAQ,GAAG,IAAIC,GAAG,CAACnB,KAAK,CAACC,qBAAqB,CAACmB,GAAG,CAACC,CAAC,IAAIC,MAAM,CAACD,CAAC,CAACV,EAAE,CAAC,CAAC,CAAC;IAC5EY,MAAM,CAACC,IAAI,CAACxB,KAAK,CAACG,uBAAuB,CAAC,CAACsB,OAAO,CAACd,EAAE,IAAI;MACrD,IAAI,CAACO,QAAQ,CAACQ,GAAG,CAACJ,MAAM,CAACX,EAAE,CAAC,CAAC,EAAE,OAAOX,KAAK,CAACG,uBAAuB,CAACQ,EAAE,CAAC;IAC3E,CAAC,CAAC;EACN,CAAC;EAEDgB,iBAAiBA,CAAChB,EAAE,EAAEiB,OAAO,EAAE;IAC3B5B,KAAK,CAACE,kBAAkB,CAACS,EAAE,CAAC,GAAG;MAAE,IAAIiB,OAAO,IAAI,CAAC,CAAC;IAAE,CAAC;EACzD,CAAC;EAEDC,qBAAqBA,CAAClB,EAAE,EAAEmB,IAAI,EAAE;IAAA,IAAAC,WAAA,EAAAC,SAAA,EAAAC,SAAA;IAC5B,MAAMC,MAAM,GAAG;MACXC,KAAK,EAAEC,MAAM,EAAAL,WAAA,GAACD,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEK,KAAK,cAAAJ,WAAA,cAAAA,WAAA,GAAI,CAAC,CAAC;MAC/BM,GAAG,EAAED,MAAM,EAAAJ,SAAA,GAACF,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEO,GAAG,cAAAL,SAAA,cAAAA,SAAA,GAAI,CAAC,CAAC;MAC3BM,GAAG,EAAEF,MAAM,EAAAH,SAAA,GAACH,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEQ,GAAG,cAAAL,SAAA,cAAAA,SAAA,GAAI,CAAC;IAC9B,CAAC;IACDjC,KAAK,CAACG,uBAAuB,CAACQ,EAAE,CAAC,GAAGuB,MAAM;EAC9C,CAAC;EAED;EACAK,KAAKA,CAAA,EAAG;IACJvC,KAAK,CAACC,qBAAqB,GAAG,EAAE;IAChCD,KAAK,CAACE,kBAAkB,GAAG,CAAC,CAAC;IAC7BF,KAAK,CAACG,uBAAuB,GAAG,CAAC,CAAC;EACtC;AACJ,CAAC;AAED,eAAeC,gBAAgB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}