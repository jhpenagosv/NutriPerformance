{"ast":null,"code":"// src/controllers/SideStatsController.js\nimport { getClasificaciones } from \"../Api/clasificacion.api\";\nimport { getMaterias } from \"../Api/materia.api\";\nexport class SideStatsController {\n  constructor({\n    refreshMs = 30000\n  } = {}) {\n    this.state = {\n      loading: false,\n      error: null,\n      total: 0,\n      items: []\n    };\n    this.refreshMs = refreshMs;\n    this._timer = null;\n    this._subs = new Set();\n  }\n  subscribe(fn) {\n    this._subs.add(fn);\n    try {\n      fn(this.snapshot());\n    } catch {}\n    return () => this._subs.delete(fn);\n  }\n  _emit() {\n    const s = this.snapshot();\n    for (const fn of this._subs) fn(s);\n  }\n  snapshot() {\n    return {\n      ...this.state,\n      items: [...this.state.items]\n    };\n  }\n  async _loadOnce() {\n    try {\n      this.state.loading = true;\n      this.state.error = null;\n      this._emit();\n      const clasifs = await getClasificaciones();\n      const safeClasifs = Array.isArray(clasifs) ? clasifs : [];\n      const counts = await Promise.all(safeClasifs.map(async c => {\n        try {\n          const mats = await getMaterias({\n            clasificacionId: c.id\n          });\n          return {\n            id: c.id,\n            nombre: c.nombre,\n            count: Array.isArray(mats) ? mats.length : 0\n          };\n        } catch {\n          return {\n            id: c.id,\n            nombre: c.nombre,\n            count: 0\n          };\n        }\n      }));\n      counts.sort((a, b) => a.nombre.localeCompare(b.nombre, \"es\"));\n      this.state.items = counts;\n      this.state.total = counts.length;\n      this.state.loading = false;\n      this._emit();\n    } catch (e) {\n      this.state.loading = false;\n      this.state.error = \"No se pudo cargar la clasificación.\";\n      this._emit();\n    }\n  }\n  async start() {\n    await this._loadOnce();\n    if (this._timer) clearInterval(this._timer);\n    this._timer = setInterval(() => this._loadOnce(), this.refreshMs);\n  }\n  pause() {\n    if (this._timer) {\n      clearInterval(this._timer);\n      this._timer = null;\n    }\n  }\n  destroy() {\n    this.pause();\n    this._subs.clear();\n  }\n}","map":{"version":3,"names":["getClasificaciones","getMaterias","SideStatsController","constructor","refreshMs","state","loading","error","total","items","_timer","_subs","Set","subscribe","fn","add","snapshot","delete","_emit","s","_loadOnce","clasifs","safeClasifs","Array","isArray","counts","Promise","all","map","c","mats","clasificacionId","id","nombre","count","length","sort","a","b","localeCompare","e","start","clearInterval","setInterval","pause","destroy","clear"],"sources":["C:/Users/maico/OneDrive/Documentos/a/backend/src/controllers/SideStatsController.js"],"sourcesContent":["// src/controllers/SideStatsController.js\r\nimport { getClasificaciones } from \"../Api/clasificacion.api\";\r\nimport { getMaterias } from \"../Api/materia.api\";\r\n\r\nexport class SideStatsController {\r\n    constructor({ refreshMs = 30000 } = {}) {\r\n        this.state = { loading: false, error: null, total: 0, items: [] };\r\n        this.refreshMs = refreshMs;\r\n        this._timer = null;\r\n        this._subs = new Set();\r\n    }\r\n\r\n    subscribe(fn) { this._subs.add(fn); try { fn(this.snapshot()); } catch { } return () => this._subs.delete(fn); }\r\n    _emit() { const s = this.snapshot(); for (const fn of this._subs) fn(s); }\r\n    snapshot() { return { ...this.state, items: [...this.state.items] }; }\r\n\r\n    async _loadOnce() {\r\n        try {\r\n            this.state.loading = true; this.state.error = null; this._emit();\r\n\r\n            const clasifs = await getClasificaciones();\r\n            const safeClasifs = Array.isArray(clasifs) ? clasifs : [];\r\n\r\n            const counts = await Promise.all(\r\n                safeClasifs.map(async (c) => {\r\n                    try {\r\n                        const mats = await getMaterias({ clasificacionId: c.id });\r\n                        return { id: c.id, nombre: c.nombre, count: Array.isArray(mats) ? mats.length : 0 };\r\n                    } catch {\r\n                        return { id: c.id, nombre: c.nombre, count: 0 };\r\n                    }\r\n                })\r\n            );\r\n\r\n            counts.sort((a, b) => a.nombre.localeCompare(b.nombre, \"es\"));\r\n            this.state.items = counts;\r\n            this.state.total = counts.length;\r\n            this.state.loading = false;\r\n            this._emit();\r\n        } catch (e) {\r\n            this.state.loading = false;\r\n            this.state.error = \"No se pudo cargar la clasificación.\";\r\n            this._emit();\r\n        }\r\n    }\r\n\r\n    async start() {\r\n        await this._loadOnce();\r\n        if (this._timer) clearInterval(this._timer);\r\n        this._timer = setInterval(() => this._loadOnce(), this.refreshMs);\r\n    }\r\n\r\n    pause() { if (this._timer) { clearInterval(this._timer); this._timer = null; } }\r\n    destroy() { this.pause(); this._subs.clear(); }\r\n}"],"mappings":"AAAA;AACA,SAASA,kBAAkB,QAAQ,0BAA0B;AAC7D,SAASC,WAAW,QAAQ,oBAAoB;AAEhD,OAAO,MAAMC,mBAAmB,CAAC;EAC7BC,WAAWA,CAAC;IAAEC,SAAS,GAAG;EAAM,CAAC,GAAG,CAAC,CAAC,EAAE;IACpC,IAAI,CAACC,KAAK,GAAG;MAAEC,OAAO,EAAE,KAAK;MAAEC,KAAK,EAAE,IAAI;MAAEC,KAAK,EAAE,CAAC;MAAEC,KAAK,EAAE;IAAG,CAAC;IACjE,IAAI,CAACL,SAAS,GAAGA,SAAS;IAC1B,IAAI,CAACM,MAAM,GAAG,IAAI;IAClB,IAAI,CAACC,KAAK,GAAG,IAAIC,GAAG,CAAC,CAAC;EAC1B;EAEAC,SAASA,CAACC,EAAE,EAAE;IAAE,IAAI,CAACH,KAAK,CAACI,GAAG,CAACD,EAAE,CAAC;IAAE,IAAI;MAAEA,EAAE,CAAC,IAAI,CAACE,QAAQ,CAAC,CAAC,CAAC;IAAE,CAAC,CAAC,MAAM,CAAE;IAAE,OAAO,MAAM,IAAI,CAACL,KAAK,CAACM,MAAM,CAACH,EAAE,CAAC;EAAE;EAC/GI,KAAKA,CAAA,EAAG;IAAE,MAAMC,CAAC,GAAG,IAAI,CAACH,QAAQ,CAAC,CAAC;IAAE,KAAK,MAAMF,EAAE,IAAI,IAAI,CAACH,KAAK,EAAEG,EAAE,CAACK,CAAC,CAAC;EAAE;EACzEH,QAAQA,CAAA,EAAG;IAAE,OAAO;MAAE,GAAG,IAAI,CAACX,KAAK;MAAEI,KAAK,EAAE,CAAC,GAAG,IAAI,CAACJ,KAAK,CAACI,KAAK;IAAE,CAAC;EAAE;EAErE,MAAMW,SAASA,CAAA,EAAG;IACd,IAAI;MACA,IAAI,CAACf,KAAK,CAACC,OAAO,GAAG,IAAI;MAAE,IAAI,CAACD,KAAK,CAACE,KAAK,GAAG,IAAI;MAAE,IAAI,CAACW,KAAK,CAAC,CAAC;MAEhE,MAAMG,OAAO,GAAG,MAAMrB,kBAAkB,CAAC,CAAC;MAC1C,MAAMsB,WAAW,GAAGC,KAAK,CAACC,OAAO,CAACH,OAAO,CAAC,GAAGA,OAAO,GAAG,EAAE;MAEzD,MAAMI,MAAM,GAAG,MAAMC,OAAO,CAACC,GAAG,CAC5BL,WAAW,CAACM,GAAG,CAAC,MAAOC,CAAC,IAAK;QACzB,IAAI;UACA,MAAMC,IAAI,GAAG,MAAM7B,WAAW,CAAC;YAAE8B,eAAe,EAAEF,CAAC,CAACG;UAAG,CAAC,CAAC;UACzD,OAAO;YAAEA,EAAE,EAAEH,CAAC,CAACG,EAAE;YAAEC,MAAM,EAAEJ,CAAC,CAACI,MAAM;YAAEC,KAAK,EAAEX,KAAK,CAACC,OAAO,CAACM,IAAI,CAAC,GAAGA,IAAI,CAACK,MAAM,GAAG;UAAE,CAAC;QACvF,CAAC,CAAC,MAAM;UACJ,OAAO;YAAEH,EAAE,EAAEH,CAAC,CAACG,EAAE;YAAEC,MAAM,EAAEJ,CAAC,CAACI,MAAM;YAAEC,KAAK,EAAE;UAAE,CAAC;QACnD;MACJ,CAAC,CACL,CAAC;MAEDT,MAAM,CAACW,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,CAACJ,MAAM,CAACM,aAAa,CAACD,CAAC,CAACL,MAAM,EAAE,IAAI,CAAC,CAAC;MAC7D,IAAI,CAAC5B,KAAK,CAACI,KAAK,GAAGgB,MAAM;MACzB,IAAI,CAACpB,KAAK,CAACG,KAAK,GAAGiB,MAAM,CAACU,MAAM;MAChC,IAAI,CAAC9B,KAAK,CAACC,OAAO,GAAG,KAAK;MAC1B,IAAI,CAACY,KAAK,CAAC,CAAC;IAChB,CAAC,CAAC,OAAOsB,CAAC,EAAE;MACR,IAAI,CAACnC,KAAK,CAACC,OAAO,GAAG,KAAK;MAC1B,IAAI,CAACD,KAAK,CAACE,KAAK,GAAG,qCAAqC;MACxD,IAAI,CAACW,KAAK,CAAC,CAAC;IAChB;EACJ;EAEA,MAAMuB,KAAKA,CAAA,EAAG;IACV,MAAM,IAAI,CAACrB,SAAS,CAAC,CAAC;IACtB,IAAI,IAAI,CAACV,MAAM,EAAEgC,aAAa,CAAC,IAAI,CAAChC,MAAM,CAAC;IAC3C,IAAI,CAACA,MAAM,GAAGiC,WAAW,CAAC,MAAM,IAAI,CAACvB,SAAS,CAAC,CAAC,EAAE,IAAI,CAAChB,SAAS,CAAC;EACrE;EAEAwC,KAAKA,CAAA,EAAG;IAAE,IAAI,IAAI,CAAClC,MAAM,EAAE;MAAEgC,aAAa,CAAC,IAAI,CAAChC,MAAM,CAAC;MAAE,IAAI,CAACA,MAAM,GAAG,IAAI;IAAE;EAAE;EAC/EmC,OAAOA,CAAA,EAAG;IAAE,IAAI,CAACD,KAAK,CAAC,CAAC;IAAE,IAAI,CAACjC,KAAK,CAACmC,KAAK,CAAC,CAAC;EAAE;AAClD","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}