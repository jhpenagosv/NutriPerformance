{"ast":null,"code":"// src/models/dietaBalanceada.model.js\n\n// ===== Helpers comunes =====\nconst toNumber = v => {\n  if (v === \"\" || v === null || v === undefined) return undefined;\n  const n = Number(String(v).replace(\",\", \".\"));\n  return Number.isFinite(n) ? n : undefined;\n};\nconst avg = (a, b) => a !== undefined && b !== undefined ? (a + b) / 2 : undefined;\nconst round = (v, d = 1) => typeof v === \"number\" ? Number(v.toFixed(d)) : v;\nconst round2 = (v, d = 2) => typeof v === \"number\" ? Number(v.toFixed(d)) : v;\n\n// ===== Sesión 1: Información General =====\n/**\r\n * Recibe un objeto \"raw\" que puede venir como:\r\n *  - { form: {...}, pesoMedio? }\r\n *  - o directamente el \"form\"\r\n */\nexport function buildInfoGeneral(raw) {\n  const f = raw !== null && raw !== void 0 && raw.form ? raw.form : raw || {};\n  const raza = f.raza || \"\";\n  const sistema = f.sistema || \"\";\n  const sexo = f.sexo || \"\";\n  const pesoInicial = toNumber(f.pesoInicial);\n  const pesoFinal = toNumber(f.pesoFinal);\n  const pesoMedioIn = toNumber(raw === null || raw === void 0 ? void 0 : raw.pesoMedio);\n  const pesoMedio = pesoMedioIn !== null && pesoMedioIn !== void 0 ? pesoMedioIn : avg(pesoInicial, pesoFinal);\n  const pesoDiario = toNumber(f.pesoDiario); // kg/d\n  const tempMax = toNumber(f.tempMax); // °C\n  const humedad = toNumber(f.humedad); // %\n\n  return {\n    raza,\n    sistema,\n    sexo,\n    pesoInicial: round(pesoInicial),\n    pesoFinal: round(pesoFinal),\n    pesoMedio: round(pesoMedio),\n    pesoDiario: round(pesoDiario),\n    tempMax: round(tempMax),\n    humedad: round(humedad)\n  };\n}\n\n// ===== Sesión 2A: Listado simple de materias seleccionadas =====\nexport function buildMateriasSeleccionadas(seleccionadas, restricciones) {\n  const list = Array.isArray(seleccionadas) ? seleccionadas : [];\n  const restr = restricciones && typeof restricciones === \"object\" ? restricciones : {};\n  return list.map(m => {\n    const r = restr[m.id] || {};\n    const costo = toNumber(r.costo);\n    const min = toNumber(r.min);\n    const max = toNumber(r.max);\n    return {\n      id: m.id,\n      nombre: m.nombre || \"\",\n      temporal: !!(m.temporal || m.isTemporal || m.esTemporal),\n      costo: costo !== undefined ? round2(costo) : null,\n      min: min !== undefined ? round2(min) : null,\n      max: max !== undefined ? round2(max) : null\n    };\n  });\n}\n\n// ===== Sesión 2B: Detalles bromatológicos =====\nexport const DETALLE_KEYS = [\"MS\", \"EM\", \"NDT\", \"PB\", \"Ca\", \"P\", \"Mg\", \"Na\", \"K\", \"S\", \"Cu\", \"Co\", \"Fe\", \"Mn\", \"Se\", \"Zn\", \"I\", \"FDN\", \"EE\", \"CNF\"];\n\n/** Fila de detalle para una materia */\nexport function buildDetalleBromatologicoRow(materia, detalle, keys = DETALLE_KEYS) {\n  const valores = {};\n  for (const k of keys) {\n    const raw = detalle === null || detalle === void 0 ? void 0 : detalle[k];\n    const num = toNumber(raw);\n    valores[k] = num !== undefined ? round2(num, 2) : null;\n  }\n  return {\n    id: materia.id,\n    nombre: materia.nombre || \"\",\n    temporal: !!(materia.temporal || materia.isTemporal || materia.esTemporal),\n    valores\n  };\n}\n\n/** Convierte {id -> detalle} a lista de filas */\nexport function buildDetallesBromatologicos(materias, detallesById, keys = DETALLE_KEYS) {\n  const list = Array.isArray(materias) ? materias : [];\n  return list.map(m => buildDetalleBromatologicoRow(m, detallesById === null || detallesById === void 0 ? void 0 : detallesById[m.id], keys));\n}","map":{"version":3,"names":["toNumber","v","undefined","n","Number","String","replace","isFinite","avg","a","b","round","d","toFixed","round2","buildInfoGeneral","raw","f","form","raza","sistema","sexo","pesoInicial","pesoFinal","pesoMedioIn","pesoMedio","pesoDiario","tempMax","humedad","buildMateriasSeleccionadas","seleccionadas","restricciones","list","Array","isArray","restr","map","m","r","id","costo","min","max","nombre","temporal","isTemporal","esTemporal","DETALLE_KEYS","buildDetalleBromatologicoRow","materia","detalle","keys","valores","k","num","buildDetallesBromatologicos","materias","detallesById"],"sources":["C:/Users/maico/OneDrive/Documentos/a/backend/src/models/dietaBalanceada.model.js"],"sourcesContent":["// src/models/dietaBalanceada.model.js\r\n\r\n// ===== Helpers comunes =====\r\nconst toNumber = (v) => {\r\n    if (v === \"\" || v === null || v === undefined) return undefined;\r\n    const n = Number(String(v).replace(\",\", \".\"));\r\n    return Number.isFinite(n) ? n : undefined;\r\n};\r\nconst avg = (a, b) =>\r\n    a !== undefined && b !== undefined ? (a + b) / 2 : undefined;\r\nconst round = (v, d = 1) =>\r\n    typeof v === \"number\" ? Number(v.toFixed(d)) : v;\r\nconst round2 = (v, d = 2) =>\r\n    typeof v === \"number\" ? Number(v.toFixed(d)) : v;\r\n\r\n// ===== Sesión 1: Información General =====\r\n/**\r\n * Recibe un objeto \"raw\" que puede venir como:\r\n *  - { form: {...}, pesoMedio? }\r\n *  - o directamente el \"form\"\r\n */\r\nexport function buildInfoGeneral(raw) {\r\n    const f = raw?.form ? raw.form : (raw || {});\r\n\r\n    const raza = f.raza || \"\";\r\n    const sistema = f.sistema || \"\";\r\n    const sexo = f.sexo || \"\";\r\n\r\n    const pesoInicial = toNumber(f.pesoInicial);\r\n    const pesoFinal = toNumber(f.pesoFinal);\r\n    const pesoMedioIn = toNumber(raw?.pesoMedio);\r\n    const pesoMedio = pesoMedioIn ?? avg(pesoInicial, pesoFinal);\r\n\r\n    const pesoDiario = toNumber(f.pesoDiario); // kg/d\r\n    const tempMax = toNumber(f.tempMax);    // °C\r\n    const humedad = toNumber(f.humedad);    // %\r\n\r\n    return {\r\n        raza,\r\n        sistema,\r\n        sexo,\r\n        pesoInicial: round(pesoInicial),\r\n        pesoFinal: round(pesoFinal),\r\n        pesoMedio: round(pesoMedio),\r\n        pesoDiario: round(pesoDiario),\r\n        tempMax: round(tempMax),\r\n        humedad: round(humedad),\r\n    };\r\n}\r\n\r\n// ===== Sesión 2A: Listado simple de materias seleccionadas =====\r\nexport function buildMateriasSeleccionadas(seleccionadas, restricciones) {\r\n    const list = Array.isArray(seleccionadas) ? seleccionadas : [];\r\n    const restr = restricciones && typeof restricciones === \"object\" ? restricciones : {};\r\n\r\n    return list.map((m) => {\r\n        const r = restr[m.id] || {};\r\n        const costo = toNumber(r.costo);\r\n        const min = toNumber(r.min);\r\n        const max = toNumber(r.max);\r\n\r\n        return {\r\n            id: m.id,\r\n            nombre: m.nombre || \"\",\r\n            temporal: !!(m.temporal || m.isTemporal || m.esTemporal),\r\n            costo: costo !== undefined ? round2(costo) : null,\r\n            min: min !== undefined ? round2(min) : null,\r\n            max: max !== undefined ? round2(max) : null,\r\n        };\r\n    });\r\n}\r\n\r\n// ===== Sesión 2B: Detalles bromatológicos =====\r\nexport const DETALLE_KEYS = [\r\n    \"MS\",\r\n    \"EM\",\r\n    \"NDT\",\r\n    \"PB\",\r\n    \"Ca\",\r\n    \"P\",\r\n    \"Mg\",\r\n    \"Na\",\r\n    \"K\",\r\n    \"S\",\r\n    \"Cu\",\r\n    \"Co\",\r\n    \"Fe\",\r\n    \"Mn\",\r\n    \"Se\",\r\n    \"Zn\",\r\n    \"I\",\r\n    \"FDN\",\r\n    \"EE\",\r\n    \"CNF\"\r\n];\r\n\r\n/** Fila de detalle para una materia */\r\nexport function buildDetalleBromatologicoRow(materia, detalle, keys = DETALLE_KEYS) {\r\n    const valores = {};\r\n    for (const k of keys) {\r\n        const raw = detalle?.[k];\r\n        const num = toNumber(raw);\r\n        valores[k] = num !== undefined ? round2(num, 2) : null;\r\n    }\r\n    return {\r\n        id: materia.id,\r\n        nombre: materia.nombre || \"\",\r\n        temporal: !!(materia.temporal || materia.isTemporal || materia.esTemporal),\r\n        valores\r\n    };\r\n}\r\n\r\n/** Convierte {id -> detalle} a lista de filas */\r\nexport function buildDetallesBromatologicos(materias, detallesById, keys = DETALLE_KEYS) {\r\n    const list = Array.isArray(materias) ? materias : [];\r\n    return list.map((m) => buildDetalleBromatologicoRow(m, detallesById?.[m.id], keys));\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}